[gd_scene load_steps=30 format=4 uid="uid://d0sdg4uow1xul"]

[ext_resource type="Script" uid="uid://b1ofr4umso5jf" path="res://src/systems/scenes/game/game_scene.gd" id="1_ku5ii"]
[ext_resource type="Texture2D" uid="uid://dpneh20wgfr56" path="res://src/images/panorama/panorama_folk.png" id="2_2lxk3"]
[ext_resource type="TileSet" uid="uid://2yegmxnc57fl" path="res://src/levels/_ignore/tilemaps/shieldfolk.tres" id="2_oi6n0"]
[ext_resource type="Shader" uid="uid://dqxrs4a4y611c" path="res://src/shaders/panorama/linear.gdshader" id="2_qg8hg"]
[ext_resource type="PackedScene" uid="uid://ryhx8o46er7i" path="res://src/player/madotsuki/madotsuki.tscn" id="2_yqpiu"]
[ext_resource type="Script" uid="uid://b4b3kjcm65mv6" path="res://src/systems/audio/bgm.gd" id="3_5def8"]
[ext_resource type="AudioStream" uid="uid://breccbd84casl" path="res://src/audio/bgm/world_folk.ogg" id="4_mb7v3"]
[ext_resource type="PackedScene" uid="uid://c8bnpo28a373g" path="res://src/systems/camera/camera.tscn" id="6_2lxk3"]
[ext_resource type="Script" uid="uid://jbydpt773v5a" path="res://src/entities/hostile/nav_entity.gd" id="9_coiqr"]
[ext_resource type="Texture2D" uid="uid://05eixr261ttf" path="res://src/entities/shadow.png" id="10_lq1ft"]
[ext_resource type="Texture2D" uid="uid://7de0sgf7rbaj" path="res://src/entities/sentients/cat_effect/move.png" id="11_ilpas"]
[ext_resource type="Script" uid="uid://cdjphp77kgyqr" path="res://src/systems/utils/spritesheet_formatter_animated.gd" id="12_l7tbv"]
[ext_resource type="Script" uid="uid://dd0qxrsakskma" path="res://src/entities/component/sb_component_receiver.gd" id="13_u7qvx"]
[ext_resource type="Script" uid="uid://dyhtvuyxwohdq" path="res://src/entities/component/sb_sprite_handler.gd" id="14_7ofkp"]
[ext_resource type="Script" uid="uid://sd3feymdmkd6" path="res://src/entities/sentient_fsm.gd" id="15_yjhtr"]
[ext_resource type="Script" uid="uid://bhmqr5byqpscr" path="res://src/entities/hostile/stance_states/idle.gd" id="16_lq1ft"]
[ext_resource type="Script" uid="uid://qdqcvtymsa3v" path="res://src/entities/sentient_state.gd" id="16_sot6b"]
[ext_resource type="Script" uid="uid://bk8x1gghf4e05" path="res://src/entities/hostile/stance_states/walk.gd" id="17_5gnxt"]
[ext_resource type="Script" uid="uid://rbvkxb3m2omw" path="res://src/entities/hostile/behaviour_states/idle.gd" id="18_3ojdx"]
[ext_resource type="Script" uid="uid://bj1oqttajdq2m" path="res://src/entities/hostile/behaviour_states/wander.gd" id="19_auyky"]
[ext_resource type="Script" uid="uid://clwsghva612ul" path="res://src/entities/hostile/behaviour_states/observe.gd" id="20_cmkft"]
[ext_resource type="Script" uid="uid://dbo5xans8s5ib" path="res://src/entities/hostile/behaviour_states/chase.gd" id="21_8j1jd"]
[ext_resource type="Script" uid="uid://cbg0uhsr4h72h" path="res://src/entities/hostile/behaviour_states/stare_at.gd" id="22_rqrlp"]
[ext_resource type="Script" uid="uid://sahjehrg3n8o" path="res://src/entities/hostile/behaviour_states/follow.gd" id="23_wcgki"]
[ext_resource type="PackedScene" uid="uid://djnomncx1otsq" path="res://src/systems/seamless_detector.tscn" id="25_ilpas"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o4x2n"]
shader = ExtResource("2_qg8hg")
shader_parameter/transparency = 0.0
shader_parameter/dirX = -1.0
shader_parameter/dirY = 1.0
shader_parameter/scroll_speed = 0.04
shader_parameter/initial_uv_offset = Vector2(0, 0)
shader_parameter/offset_strength = 0.1
shader_parameter/offset_strength_x_influence = 1.0
shader_parameter/offset_strength_y_influence = 1.0

[sub_resource type="NavigationPolygon" id="NavigationPolygon_coiqr"]
vertices = PackedVector2Array(110, -52, 110, 16, -226, 16, -309.398, -52, -294.57, 200, -226, 140, 198, 200, 198, 140)
polygons = Array[PackedInt32Array]([PackedInt32Array(0, 1, 2, 3), PackedInt32Array(4, 3, 2, 5), PackedInt32Array(6, 4, 5, 7)])
outlines = Array[PackedVector2Array]([PackedVector2Array(120, -62, -320, -62, -320, 210, 208, 210, 208, 130, -216, 130, -216, 26, 120, 26)])

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_18lqh"]
blend_mode = 2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_18lqh"]
size = Vector2(8, 6)

[node name="shield-folk_world" type="Node"]
script = ExtResource("1_ku5ii")
metadata/_custom_type_script = "uid://b1ofr4umso5jf"

[node name="BGM" type="Node" parent="."]
script = ExtResource("3_5def8")
stream = ExtResource("4_mb7v3")
metadata/_custom_type_script = "uid://b4b3kjcm65mv6"

[node name="panorama (bottom_layer)" type="CanvasLayer" parent="."]
layer = -30

[node name="TextureRect" type="TextureRect" parent="panorama (bottom_layer)"]
material = SubResource("ShaderMaterial_o4x2n")
offset_right = 484.0
offset_bottom = 274.0
texture = ExtResource("2_2lxk3")
expand_mode = 1
stretch_mode = 6

[node name="camera" parent="." instance=ExtResource("6_2lxk3")]

[node name="camera_handler" parent="camera" index="0" node_paths=PackedStringArray("target")]
target = NodePath("../../y_order/Madotsuki")

[node name="y_order" type="Node2D" parent="."]
y_sort_enabled = true

[node name="Madotsuki" parent="y_order" instance=ExtResource("2_yqpiu")]
position = Vector2(468, 320)

[node name="folk" type="TileMapLayer" parent="y_order"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAARAAwAAAADAAIAABACAAYAAAAAAAIAAAAEAAgAAAAJAAIAAAAzAB4AAAAAAAIAAABEAAsAAAAGAAIAAAANAC4AAAAJAAIAAAAPAC8AAAAJAAIAAAATAC4AAAAJAAIAABAVAC0AAAAGAAIAABAWAC8AAAAAAAIAABAbAC4AAAADAAIAAAAeAC4AAAADAAIAAAAZADAAAAAJAAIAAABYAAUAAAAAAAIAABBgABsAAAADAAIAABBfAC4AAAAAAAIAABBTAEAAAAAJAAIAABBQAEAAAAADAAIAAABTAEMAAAAGAAIAABAoAEAAAAADAAIAAAA3AEYAAAAAAAIAAAA6AEYAAAAGAAIAABBSAFMAAAAGAAIAABBUAFIAAAAAAAIAABBXAFMAAAADAAIAABBVAFUAAAAGAAIAABBbAFAAAAAAAAIAABBbAFQAAAAAAAIAABBdAFIAAAAJAAIAABBgAFoAAAAGAAIAABBfAFcAAAAGAAIAABBhAFQAAAAGAAIAABBhAF8AAAAGAAIAABBcAGEAAAAAAAIAABBcAF0AAAAGAAIAABBeAF4AAAAJAAIAABBXAGAAAAAGAAIAABBYAF0AAAAJAAIAABBUAF4AAAAAAAIAABBUAGAAAAAGAAIAABBQAF4AAAADAAIAABALAEgAAAADAAIAABArAF4AAAAAAAIAAABAADEAAAADAAIAABAfAE4AAAAJAAIAABAIABsAAAAJAAIAAABNADcAAAAJAAIAABBQADcAAAAJAAIAABBTADcAAAAJAAIAABBWADcAAAAAAAIAABBZADcAAAAJAAIAABBcADcAAAAAAAIAABBfADcAAAADAAIAABBtACcAAAAGAAIAAABqACcAAAAJAAIAAABnACcAAAAAAAIAAABkACcAAAAAAAIAAABbACcAAAAJAAIAAABdACUAAAAAAAIAABBjACUAAAAGAAIAABBmACUAAAADAAIAABBpACUAAAADAAIAABBwACMAAAAJAAIAAABqACMAAAAJAAIAAABnACMAAAADAAIAAABkACMAAAAAAAIAAABhACMAAAAGAAIAAABeACMAAAADAAIAAABgACEAAAAAAAIAABBjACEAAAADAAIAABBmACEAAAAAAAIAABBpACEAAAAJAAIAABBsACEAAAAJAAIAABBvACEAAAAJAAIAABByACEAAAAGAAIAABB5ACcAAAAJAAIAAAB2ACcAAAAGAAIAAABzACcAAAADAAIAAABwACcAAAAAAAIAAAB7ACUAAAAAAAIAABB1ACUAAAAGAAIAABByACUAAAAJAAIAABB8ACMAAAAJAAIAAAB2ACMAAAADAAIAAABzACMAAAAAAAIAAAB+ACEAAAAAAAIAABB7ACEAAAADAAIAABB4ACEAAAAGAAIAABB1ACEAAAAJAAIAABA=")
tile_set = ExtResource("2_oi6n0")

[node name="blob_static" type="TileMapLayer" parent="y_order"]
y_sort_enabled = true
tile_map_data = PackedByteArray("AAAJABMAAAAAAAEAABALABUAAAAAAAAAAAAVAAQAAAAAAAEAAAAWAAYAAAAAAAEAABBJABcAAAAAAAEAABA4ABIAAAAAAAEAABAzAAwAAAAAAAEAAAAwAC0AAAAAAAEAAAAjACQAAAAAAAEAAABcAAwAAAAAAAEAABBaAC0AAAAAAAEAABASADsAAAAAAAEAABARADsAAAAAAAEAABAKADUAAAAAAAEAABA6AE8AAAAAAAEAAAAvAEwAAAAAAAEAAABMAEkAAAAAAAEAAABgAD4AAAAAAAEAAABpACkAAAAAAAEAAABpACoAAAAAAAEAAABrACoAAAAAAAEAAABsACwAAAAAAAEAAAB9ACcAAAAAAAEAAAB+ACcAAAAAAAEAAAB/ACYAAAAAAAEAAAB4ABsAAAAAAAEAAAB0ABwAAAAAAAEAAABaACAAAAAAAAEAAABaACMAAAAAAAEAAABZACMAAAAAAAEAAABeACcAAAAAAAEAAABfACYAAAAAAAEAAABgACYAAAAAAAEAAABiACcAAAAAAAEAAABuACQAAAAAAAEAAAB4ACQAAAAAAAEAAABnABoAAAAAAAEAABB4ADgAAAAAAAEAABA0ADgAAAAAAAEAABBEACIAAAAAAAEAABAVAF4AAAAAAAEAABASAFgAAAAAAAEAABATAFgAAAAAAAEAABBPAFIAAAAAAAEAAABOAFMAAAAAAAEAAABZAFMAAAAAAAEAAABYAFEAAAAAAAEAAABeAFQAAAAAAAEAAABiAFwAAAAAAAEAAABaAF8AAAAAAAEAAABZAGEAAAAAAAEAAABLAF8AAAAAAAEAAABKAF0AAAAAAAAAAABRAGEAAAAAAAAAAABiAGIAAAAAAAAAAABlAFkAAAAAAAAAAABVAE4AAAAAAAAAAAA8AE0AAAAAAAAAAAAuAE0AAAAAAAAAAAAsAEwAAAAAAAAAAAArAE0AAAAAAAAAAAAqAE0AAAAAAAAAAAATAFoAAAAAAAAAAAALAD8AAAAAAAAAAABfACkAAAAAAAAAAABYACYAAAAAAAAAAABXACMAAAAAAAAAAABsABkAAAAAAAAAAABtABkAAAAAAAAAAABtABgAAAAAAAAAAABsABcAAAAAAAAAAABsABYAAAAAAAAAAABsABUAAAAAAAAAAABrABUAAAAAAAAAAABrABYAAAAAAAAAAAA9AB8AAAAAAAAAAAAoAB4AAAAAAAAAAAAgABwAAAAAAAAAAAAhABoAAAAAAAAAAAA5AAgAAAAAAAAAAAA6AAgAAAAAAAAAAABLAAUAAAAAAAAAAABPAA8AAAAAAAAAAAASACEAAAAAAAAAAAATACEAAAAAAAAAAAAeACcAAAAAAAAAAAAnADUAAAAAAAAAAAAnADYAAAAAAAAAAABGACkAAAAAAAAAAABHACkAAAAAAAAAAAA=")
tile_set = ExtResource("2_oi6n0")

[node name="gates" type="TileMapLayer" parent="y_order"]
y_sort_enabled = true
tile_set = ExtResource("2_oi6n0")

[node name="nav_region" type="NavigationRegion2D" parent="y_order"]
position = Vector2(992, 1038)
navigation_polygon = SubResource("NavigationPolygon_coiqr")

[node name="neko_effect" type="CharacterBody2D" parent="y_order" node_paths=PackedStringArray("nav_agent", "stance_fsm", "behaviour_fsm")]
position = Vector2(992, 1038)
script = ExtResource("9_coiqr")
nav_agent = NodePath("nav")
stance_fsm = NodePath("stance_fsm")
behaviour_fsm = NodePath("behaviour_fsm")
initial_speed = 34.3

[node name="on_screen_enabler" type="VisibleOnScreenEnabler2D" parent="y_order/neko_effect"]
rect = Rect2(-50, -40, 100, 80)

[node name="shadow_renderer" type="Sprite2D" parent="y_order/neko_effect"]
material = SubResource("CanvasItemMaterial_18lqh")
position = Vector2(0, 16)
texture = ExtResource("10_lq1ft")
offset = Vector2(0, -24)

[node name="sprite_renderer" type="Sprite2D" parent="y_order/neko_effect"]
position = Vector2(0, -1)
texture = ExtResource("11_ilpas")
hframes = 4
frame = 2
script = ExtResource("12_l7tbv")
autoplay = true
playing = true
loop = true
fps = 10.0
frame_dimensions = Vector2i(16, 16)
frame_h_count = 4
progress = 2
metadata/_custom_type_script = "uid://cdjphp77kgyqr"

[node name="sb_components" type="Node2D" parent="y_order/neko_effect"]
script = ExtResource("13_u7qvx")
metadata/_custom_type_script = "uid://dd0qxrsakskma"

[node name="sprite_handler" type="Node" parent="y_order/neko_effect/sb_components"]
script = ExtResource("14_7ofkp")
metadata/_custom_type_script = "uid://bgisym1hdeqgt"

[node name="coll" type="CollisionShape2D" parent="y_order/neko_effect"]
position = Vector2(0, 2)
shape = SubResource("RectangleShape2D_18lqh")

[node name="nav" type="NavigationAgent2D" parent="y_order/neko_effect"]
target_desired_distance = 25.0
avoidance_enabled = true
debug_enabled = true

[node name="stance_fsm" type="Node" parent="y_order/neko_effect" node_paths=PackedStringArray("initial_state")]
script = ExtResource("15_yjhtr")
initial_state = NodePath("IDLE")
metadata/_custom_type_script = "uid://co5edhtkgx3g8"

[node name="IDLE" type="Node" parent="y_order/neko_effect/stance_fsm"]
script = ExtResource("16_lq1ft")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="WALK" type="Node" parent="y_order/neko_effect/stance_fsm"]
script = ExtResource("17_5gnxt")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="RUN" type="Node" parent="y_order/neko_effect/stance_fsm"]
script = ExtResource("16_sot6b")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="TAUNT" type="Node" parent="y_order/neko_effect/stance_fsm"]
script = ExtResource("16_sot6b")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="behaviour_fsm" type="Node" parent="y_order/neko_effect" node_paths=PackedStringArray("initial_state")]
script = ExtResource("15_yjhtr")
initial_state = NodePath("WANDER")
metadata/_custom_type_script = "uid://co5edhtkgx3g8"

[node name="path_update" type="Timer" parent="y_order/neko_effect/behaviour_fsm"]

[node name="IDLE" type="Node" parent="y_order/neko_effect/behaviour_fsm"]
script = ExtResource("18_3ojdx")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="WANDER" type="Node" parent="y_order/neko_effect/behaviour_fsm" node_paths=PackedStringArray("stance_fsm", "idle_timer", "path_timer_update")]
script = ExtResource("19_auyky")
stance_fsm = NodePath("../../stance_fsm")
idle_timer = NodePath("idle_timer")
path_timer_update = NodePath("../path_update")
min_wait_time = 0.0
max_wait_time = 0.5
wander_radius = 35.0
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="idle_timer" type="Timer" parent="y_order/neko_effect/behaviour_fsm/WANDER"]

[node name="OBSERVE" type="Node" parent="y_order/neko_effect/behaviour_fsm" node_paths=PackedStringArray("stance_fsm", "hesitance_timer")]
script = ExtResource("20_cmkft")
stance_fsm = NodePath("../../stance_fsm")
hesitance_timer = NodePath("hesitance_timer")
metadata/_custom_type_script = "uid://sd3feymdmkd6"

[node name="hesitance_timer" type="Timer" parent="y_order/neko_effect/behaviour_fsm/OBSERVE"]

[node name="CHASE" type="Node" parent="y_order/neko_effect/behaviour_fsm" node_paths=PackedStringArray("stance_fsm")]
script = ExtResource("21_8j1jd")
stance_fsm = NodePath("../../stance_fsm")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="STARE_AT" type="Node" parent="y_order/neko_effect/behaviour_fsm"]
script = ExtResource("22_rqrlp")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="FOLLOW" type="Node" parent="y_order/neko_effect/behaviour_fsm"]
script = ExtResource("23_wcgki")
metadata/_custom_type_script = "uid://qdqcvtymsa3v"

[node name="seamless_detector" parent="." instance=ExtResource("25_ilpas")]
position = Vector2(-80, -96)
expansion = Vector2i(90, 80)
boundary_size = Vector2i(1920, 1536)

[editable path="camera"]
