[gd_scene load_steps=29 format=3 uid="uid://bl24ldxfxb508"]

[ext_resource type="Texture2D" uid="uid://bthqacspvj0dv" path="res://src/player/inventory/petal_pink.png" id="1_1btln"]
[ext_resource type="Texture2D" uid="uid://x8um7uotrwnv" path="res://src/player/inventory/what.png" id="1_hnmhd"]
[ext_resource type="Theme" uid="uid://bv8atq67jgwrc" path="res://src/global_theme.tres" id="1_jwvlf"]
[ext_resource type="Texture2D" uid="uid://cs08f133r86y2" path="res://src/player/inventory/mado.png" id="2_3hyeo"]
[ext_resource type="Shader" uid="uid://cqc638thw4csm" path="res://src/shaders/masks/multiply.gdshader" id="2_f6805"]
[ext_resource type="Texture2D" uid="uid://m68cqpctvey4" path="res://src/player/inventory/petal_white.png" id="2_q6odh"]
[ext_resource type="Theme" uid="uid://bbm2vcixqf0gs" path="res://src/code_theme.tres" id="2_qqfc2"]
[ext_resource type="Script" uid="uid://dhvrb58iweuo0" path="res://src/ui/gui/gui_panel_button.gd" id="3_1btln"]
[ext_resource type="Texture2D" uid="uid://c6ybhwpcy6a4b" path="res://src/player/inventory/inv_eff.png" id="3_qqfc2"]
[ext_resource type="Script" uid="uid://sptd6yjcf24k" path="res://src/ui/abstract_button.gd" id="3_ssbrt"]
[ext_resource type="Texture2D" uid="uid://c4ttx5tl8lyso" path="res://src/player/inventory/inventory_toggle.png" id="4_8vhxa"]
[ext_resource type="Shader" uid="uid://hsx1wbnb1rif" path="res://src/shaders/screen_overlay/bw_invert_blur.gdshader" id="4_f6805"]
[ext_resource type="Texture2D" uid="uid://641771i2v7id" path="res://src/player/hud/stats_mobility.png" id="12_f6805"]
[ext_resource type="Texture2D" uid="uid://bwu4uvhnwkx8j" path="res://src/player/inventory/white_petal_stats.png" id="12_tlelv"]
[ext_resource type="Texture2D" uid="uid://4hm3ms1l4bg" path="res://src/player/inventory/inv_stats.png" id="13_jwvlf"]
[ext_resource type="Texture2D" uid="uid://qb3b0xt471r1" path="res://src/player/hud/stam_mobility.png" id="13_ssbrt"]

[sub_resource type="GDScript" id="GDScript_jwvlf"]
resource_name = "inventory"
script/source = "extends FSM

var invert_cutscene_listener: EventListener

@export var display: Control
@export var white_petal: Control
@export var pink_petal: Control

@export var inventory_toggle: AbstractButton
@export var spr_white_petal: Sprite2D
@export var spr_pink_petal: Sprite2D

var inventory_open: bool
var petal_tween: Tween

func _ready() -> void:
	spr_white_petal.rotation_degrees = 0 if curr_state.get_state_str() == \"white_petal\" else -90
	spr_pink_petal.rotation_degrees = 0 if curr_state.get_state_str() == \"pink_petal\" else -90
	
	invert_cutscene_listener = EventListener.new([\"SPECIAL_INVERT_CUTSCENE_BEGIN\", \"SPECIAL_INVERT_CUTSCENE_END\"], false, self)
	state_changed.connect(func(_state):
		petal_tween = create_tween().chain().set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_EXPO)
		petal_tween.tween_property(spr_white_petal, \"rotation_degrees\", spr_white_petal.rotation_degrees + 90, 0.2)
		petal_tween.tween_property(spr_pink_petal, \"rotation_degrees\", spr_pink_petal.rotation_degrees + 90, 0.2)
		
		await petal_tween.finished
		
		if spr_white_petal.rotation_degrees == 90: spr_white_petal.rotation_degrees = -90
		if spr_pink_petal.rotation_degrees == 90: spr_pink_petal.rotation_degrees = -90
		)
	
	display.visible = false
	inventory_toggle.pressed.connect(func(): 
		inventory_open = !inventory_open
		if inventory_open: GameManager.EventManager.invoke_event(\"SPECIAL_INVERT_CUTSCENE_BEGIN\")
		else: GameManager.EventManager.invoke_event(\"SPECIAL_INVERT_CUTSCENE_END\")
		)
"

[sub_resource type="GDScript" id="GDScript_8vhxa"]
resource_name = "pink_petal"
script/source = "extends State

@export var mado: Sprite2D
@export var effects: Sprite2D
@export var container: Control

var tween: Tween

@export var overlay_modulate: ColorRect

func enter_state(s = null) -> void: 
	mado.position.x -= 10
	effects.position.x -= 20
	container.position.x -= 35
	
	if tween != null: tween.kill()
	tween = self.create_tween()
	tween.set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_EXPO)
	tween.chain()
	
	tween.tween_property(mado, \"position:x\", 96, 0.5)
	tween.tween_property(effects, \"position:x\", 192, 0.5)
	tween.tween_property(container, \"position:x\", 264, 0.5)
	
func exit_state(s = null) -> void:
	tween.tween_property(mado, \"position:x\", 96 - 10, 0.5)
	tween.tween_property(effects, \"position:x\", 192 - 15, 0.5)
	tween.tween_property(container, \"position:x\", 264 - 35, 0.5)
	
	if tween != null: tween.kill()
"

[sub_resource type="GDScript" id="GDScript_ssbrt"]
resource_name = "white_petal"
script/source = "extends State

@export var mado: Sprite2D
@export var stats: Sprite2D
@export var container: Control

var tween: Tween

@export var overlay_modulate: ColorRect

func enter_state(s = null) -> void: 
	mado.position.x -= 10
	stats.position.x -= 20
	container.position.x -= 35
	
	if tween != null: tween.kill()
	tween = self.create_tween()
	tween.set_ease(Tween.EASE_OUT).set_trans(Tween.TRANS_EXPO)
	tween.chain()
	
	tween.tween_property(mado, \"position:x\", 96, 0.5)
	tween.tween_property(stats, \"position:x\", 192, 0.5)
	tween.tween_property(container, \"position:x\", 264, 0.5)
	
func exit_state(s = null) -> void:
	tween.tween_property(mado, \"position:x\", 96 - 10, 0.5)
	tween.tween_property(stats, \"position:x\", 192 - 15, 0.5)
	tween.tween_property(container, \"position:x\", 264 - 35, 0.5)
	
	if tween != null: tween.kill()
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_8vhxa"]
shader = ExtResource("4_f6805")
shader_parameter/blur_amount = 1.5
shader_parameter/pixel_size = 380.0
shader_parameter/contrast = 1.0

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_qtnvx"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_x31xm"]
shader = ExtResource("2_f6805")
shader_parameter/transparency = 0.0
shader_parameter/optional_grad = false

[sub_resource type="CanvasTexture" id="CanvasTexture_dy1qg"]

[sub_resource type="CanvasTexture" id="CanvasTexture_xcy70"]

[sub_resource type="CanvasTexture" id="CanvasTexture_g27ux"]

[sub_resource type="CanvasTexture" id="CanvasTexture_q6odh"]

[sub_resource type="CanvasTexture" id="CanvasTexture_ocwh1"]

[sub_resource type="CanvasTexture" id="CanvasTexture_tlelv"]

[node name="inventory" type="Control" node_paths=PackedStringArray("display", "white_petal", "pink_petal", "inventory_toggle", "initial_state")]
layout_mode = 3
anchors_preset = 0
theme = ExtResource("1_jwvlf")
script = SubResource("GDScript_jwvlf")
display = NodePath("display")
white_petal = NodePath("display/white_petal_stats")
pink_petal = NodePath("display/pink_petal_effects")
inventory_toggle = NodePath("toggle")
initial_state = NodePath("PINK_PETAL")

[node name="PINK_PETAL" type="Node" parent="."]
script = SubResource("GDScript_8vhxa")
metadata/_custom_type_script = "uid://r0etyaq71dla"

[node name="WHITE_PETAL" type="Node" parent="." node_paths=PackedStringArray("mado", "stats", "container", "overlay_modulate")]
script = SubResource("GDScript_ssbrt")
mado = NodePath("../display/white_petal_stats/mado")
stats = NodePath("../display/white_petal_stats/stats")
container = NodePath("../display/white_petal_stats/stats_container")
overlay_modulate = NodePath("../display/multiply_modulate")
metadata/_custom_type_script = "uid://r0etyaq71dla"

[node name="display" type="Control" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_right = 480.0
offset_bottom = 270.0
grow_horizontal = 2
grow_vertical = 2

[node name="distortion_effect" type="TextureRect" parent="display"]
material = SubResource("ShaderMaterial_8vhxa")
clip_contents = true
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = SubResource("PlaceholderTexture2D_qtnvx")
expand_mode = 2
stretch_mode = 1

[node name="multiply_modulate" type="ColorRect" parent="display"]
material = SubResource("ShaderMaterial_x31xm")
clip_contents = true
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.975233, 0.589056, 0.846138, 1)

[node name="effects_petal_pink" type="Sprite2D" parent="display"]
position = Vector2(0, -16)
texture = ExtResource("1_1btln")
centered = false

[node name="stats_petal_white" type="Sprite2D" parent="display"]
position = Vector2(0, -16)
rotation = -1.5708
texture = ExtResource("2_q6odh")
centered = false

[node name="pink_petal_effects" type="Control" parent="display"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="inv_container" type="NinePatchRect" parent="display/pink_petal_effects"]
layout_mode = 0
offset_left = 184.0
offset_top = 80.0
offset_right = 448.0
offset_bottom = 240.0
texture = ExtResource("1_hnmhd")
patch_margin_left = 6
patch_margin_top = 6
patch_margin_right = 6
patch_margin_bottom = 6

[node name="MarginContainer" type="MarginContainer" parent="display/pink_petal_effects/inv_container"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_constants/margin_left = 6
theme_override_constants/margin_top = 6
theme_override_constants/margin_right = 6
theme_override_constants/margin_bottom = 6

[node name="GridContainer" type="GridContainer" parent="display/pink_petal_effects/inv_container/MarginContainer"]
layout_mode = 2
mouse_filter = 2

[node name="GUIPanelButton" type="Control" parent="display/pink_petal_effects/inv_container/MarginContainer/GridContainer"]
custom_minimum_size = Vector2(52, 40)
layout_mode = 2
theme = ExtResource("2_qqfc2")
script = ExtResource("3_1btln")
button_display_texture = SubResource("CanvasTexture_dy1qg")
min_size = Vector2(52, 40)
true_size = Vector2(52, 40)
panel_display_texture = SubResource("CanvasTexture_xcy70")
panel_display_color = Color(1, 1, 1, 1)
metadata/_custom_type_script = "uid://dhvrb58iweuo0"

[node name="GUIPanelButton2" type="Control" parent="display/pink_petal_effects/inv_container/MarginContainer/GridContainer"]
custom_minimum_size = Vector2(52, 40)
layout_mode = 2
theme = ExtResource("2_qqfc2")
script = ExtResource("3_1btln")
button_display_texture = SubResource("CanvasTexture_g27ux")
min_size = Vector2(52, 40)
true_size = Vector2(52, 40)
panel_display_texture = SubResource("CanvasTexture_q6odh")
panel_display_color = Color(1, 1, 1, 1)
metadata/_custom_type_script = "uid://dhvrb58iweuo0"

[node name="GUIPanelButton3" type="Control" parent="display/pink_petal_effects/inv_container/MarginContainer/GridContainer"]
custom_minimum_size = Vector2(52, 40)
layout_mode = 2
theme = ExtResource("2_qqfc2")
script = ExtResource("3_1btln")
button_display_texture = SubResource("CanvasTexture_ocwh1")
min_size = Vector2(52, 40)
true_size = Vector2(52, 40)
panel_display_texture = SubResource("CanvasTexture_tlelv")
panel_display_color = Color(1, 1, 1, 1)
metadata/_custom_type_script = "uid://dhvrb58iweuo0"

[node name="mado" type="Sprite2D" parent="display/pink_petal_effects"]
position = Vector2(96, 160)
texture = ExtResource("2_3hyeo")

[node name="effects" type="Sprite2D" parent="display/pink_petal_effects"]
position = Vector2(192, 32)
texture = ExtResource("3_qqfc2")
centered = false

[node name="white_petal_stats" type="Control" parent="display"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="stats_container" type="NinePatchRect" parent="display/white_petal_stats"]
layout_mode = 0
offset_left = 48.0
offset_top = 80.0
offset_right = 312.0
offset_bottom = 240.0
texture = ExtResource("1_hnmhd")
patch_margin_left = 6
patch_margin_top = 6
patch_margin_right = 6
patch_margin_bottom = 6

[node name="margin" type="MarginContainer" parent="display/white_petal_stats/stats_container"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
theme_override_constants/margin_left = 16
theme_override_constants/margin_top = 16
theme_override_constants/margin_right = 16
theme_override_constants/margin_bottom = 16

[node name="vbox" type="VBoxContainer" parent="display/white_petal_stats/stats_container/margin"]
layout_mode = 2

[node name="stats_mobility" type="TextureRect" parent="display/white_petal_stats/stats_container/margin/vbox"]
layout_mode = 2
texture = ExtResource("12_f6805")
stretch_mode = 2

[node name="mobility" type="Label" parent="display/white_petal_stats/stats_container/margin/vbox"]
layout_mode = 2
text = "BASE SPEED: xx
Walk Multi: xx
Run Multi: xx
Sneak Multi: xx
"

[node name="stats_stamina" type="TextureRect" parent="display/white_petal_stats/stats_container/margin/vbox"]
layout_mode = 2
texture = ExtResource("13_ssbrt")
stretch_mode = 2

[node name="stamina" type="Label" parent="display/white_petal_stats/stats_container/margin/vbox"]
layout_mode = 2
text = "Stamina Regen: xx / s
Stamina Drain: xx/s"

[node name="mado" type="Sprite2D" parent="display/white_petal_stats"]
position = Vector2(384.5, 151)
texture = ExtResource("12_tlelv")

[node name="stats" type="Sprite2D" parent="display/white_petal_stats"]
position = Vector2(42, 32)
texture = ExtResource("13_jwvlf")
centered = false

[node name="toggle" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_left = 24.0
offset_top = 224.0
offset_right = 72.0
offset_bottom = 256.0
mouse_filter = 1
script = ExtResource("3_ssbrt")
metadata/_custom_type_script = "uid://sptd6yjcf24k"

[node name="sprite" type="Sprite2D" parent="toggle"]
texture = ExtResource("4_8vhxa")
centered = false

[node name="Control" type="Control" parent="."]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_right = 480.0
offset_bottom = 25.0
grow_horizontal = 2
grow_vertical = 2
